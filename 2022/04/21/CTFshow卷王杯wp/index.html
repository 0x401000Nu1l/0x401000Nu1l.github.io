<!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=2"><meta name="theme-color" content="#FFF"><link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon.png"><link rel="icon" type="image/ico" sizes="32x32" href="/images/favicon.ico"><meta http-equiv="Cache-Control" content="no-transform"><meta http-equiv="Cache-Control" content="no-siteapp"><link rel="alternate" type="application/rss+xml" title="你越安静,你能听到的就越多" href="https://0x401000nu1l.github.io/rss.xml"><link rel="alternate" type="application/atom+xml" title="你越安静,你能听到的就越多" href="https://0x401000nu1l.github.io/atom.xml"><link rel="alternate" type="application/json" title="你越安静,你能听到的就越多" href="https://0x401000nu1l.github.io/feed.json"><link rel="stylesheet" href="//fonts.googleapis.com/css?family=Mulish:300,300italic,400,400italic,700,700italic%7CFredericka%20the%20Great:300,300italic,400,400italic,700,700italic%7CNoto%20Serif%20JP:300,300italic,400,400italic,700,700italic%7CNoto%20Serif%20SC:300,300italic,400,400italic,700,700italic%7CInconsolata:300,300italic,400,400italic,700,700italic&display=swap&subset=latin,latin-ext"><link rel="stylesheet" href="/css/app.css?v=0.2.5"><meta name="keywords" content="Reverse_wp_ctfshow_卷王杯"><link rel="canonical" href="https://0x401000nu1l.github.io/2022/04/21/CTFshow%E5%8D%B7%E7%8E%8B%E6%9D%AFwp/"><title>CTFshow卷王杯wp | 那我就让时光倒流 = 你越安静,你能听到的就越多</title><meta name="generator" content="Hexo 6.1.0"></head><body itemscope itemtype="http://schema.org/WebPage"><div id="loading"><div class="cat"><div class="body"></div><div class="head"><div class="face"></div></div><div class="foot"><div class="tummy-end"></div><div class="bottom"></div><div class="legs left"></div><div class="legs right"></div></div><div class="paw"><div class="hands left"></div><div class="hands right"></div></div></div></div><div id="container"><header id="header" itemscope itemtype="http://schema.org/WPHeader"><div class="inner"><div id="brand"><div class="pjax"><h1 itemprop="name headline">CTFshow卷王杯wp</h1><div class="meta"><span class="item" title="Created: 2022-04-21 00:07:10"><span class="icon"><i class="ic i-calendar"></i> </span><span class="text">Posted on</span> <time itemprop="dateCreated datePublished" datetime="2022-04-21T00:07:10+08:00">2022-04-21</time> </span><span class="item" title="Symbols count in article"><span class="icon"><i class="ic i-pen"></i> </span><span class="text">Symbols count in article</span> <span>3.9k</span> <span class="text">words</span> </span><span class="item" title="Reading time"><span class="icon"><i class="ic i-clock"></i> </span><span class="text">Reading time</span> <span>4 mins.</span></span></div></div></div><nav id="nav"><div class="inner"><div class="toggle"><div class="lines" aria-label="Toggle navigation bar"><span class="line"></span> <span class="line"></span> <span class="line"></span></div></div><ul class="menu"><li class="item title"><a href="/" rel="start">那我就让时光倒流</a></li></ul><ul class="right"><li class="item theme"><i class="ic i-sun"></i></li><li class="item search"><i class="ic i-search"></i></li></ul></div></nav></div><div id="imgs" class="pjax"><ul><li class="item" data-background-image="https://tva2.sinaimg.cn/large/6833939bly1gicm0fdw5cj20zk0m8hdt.jpg"></li><li class="item" data-background-image="https://tva2.sinaimg.cn/large/6833939bly1giph4wqtg4j20zk0m8x6p.jpg"></li><li class="item" data-background-image="https://tva2.sinaimg.cn/large/6833939bly1giclh5u05ej20zk0m87df.jpg"></li><li class="item" data-background-image="https://tva2.sinaimg.cn/large/6833939bly1giciuv0socj20zk0m8qes.jpg"></li><li class="item" data-background-image="https://tva2.sinaimg.cn/large/6833939bly1gipex2cdtbj20zk0m8x6p.jpg"></li><li class="item" data-background-image="https://tva2.sinaimg.cn/large/6833939bly1gipetv6p75j20zk0m8x6p.jpg"></li></ul></div></header><div id="waves"><svg class="waves" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 24 150 28" preserveAspectRatio="none" shape-rendering="auto"><defs><path id="gentle-wave" d="M-160 44c30 0 58-18 88-18s 58 18 88 18 58-18 88-18 58 18 88 18 v44h-352z"/></defs><g class="parallax"><use xlink:href="#gentle-wave" x="48" y="0"/><use xlink:href="#gentle-wave" x="48" y="3"/><use xlink:href="#gentle-wave" x="48" y="5"/><use xlink:href="#gentle-wave" x="48" y="7"/></g></svg></div><main><div class="inner"><div id="main" class="pjax"><div class="article wrap"><div class="breadcrumb" itemscope itemtype="https://schema.org/BreadcrumbList"><i class="ic i-home"></i> <span><a href="/">Home</a></span></div><article itemscope itemtype="http://schema.org/Article" class="post block" lang="en"><link itemprop="mainEntityOfPage" href="https://0x401000nu1l.github.io/2022/04/21/CTFshow%E5%8D%B7%E7%8E%8B%E6%9D%AFwp/"><span hidden itemprop="author" itemscope itemtype="http://schema.org/Person"><meta itemprop="image" content="/images/avatar.jpg"><meta itemprop="name" content="那我就让时光倒流"><meta itemprop="description" content=", (σﾟ∀ﾟ)σ..:*☆哎哟不错哦"></span><span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization"><meta itemprop="name" content="你越安静,你能听到的就越多"></span><div class="body md" itemprop="articleBody"><h3 id="ctfshow-卷王杯-wp"><a class="anchor" href="#ctfshow-卷王杯-wp">#</a> <strong>CTFshow 卷王杯 wp</strong></h3><h4 id="简单的re"><a class="anchor" href="#简单的re">#</a> 简单的 re</h4><p><a href="%5Bctf.show%5D(https://ctf.show/challenges#%E7%AE%80%E5%8D%95%E7%9A%84re-1827)">下载附件</a></p><p>下载文件查看信息， **ELF,64 位，UPX 壳 **</p><p>因为用的 wsl 环境，所以直接远程动态调试手动脱壳</p><h5 id="记录一次脱壳"><a class="anchor" href="#记录一次脱壳">#</a> 记录一次脱壳</h5><p>使用 wsl&amp;windows 远程调试，wsl 的 ip 地址是一直在变化的，所以每次启动 wsl 时都得查看 wsl 的 ip 地址</p><figure class="highlight bash"><figcaption data-lang="bash"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token function">ifconfig</span></pre></td></tr></table></figure><p>然后启动 ida 目录下的 linux_server64，IDA 端开启动态调试</p><p>因为直接启动程序显示跳飞，所以直接在第一个函数调用处下断点</p><p><img data-src="image-20220421100430381.png" alt="image-20220421100430381">!</p><p><img data-src="image-20220421100803203.png" alt="image-20220421100803203"></p><p>遇到循环直接跳过， 下断点然后 F9</p><p><img data-src="image-20220421100916353.png" alt="image-20220421100916353"></p><p>接着一路 F8，</p><p><img data-src="image-20220421101114688.png" alt="image-20220421101114688"></p><p>到这里 F7 步入，进入该函数之后一路 F7，就能在函数末尾看到一个比较大的跳转</p><p><img data-src="image-20220421101210954.png" alt="image-20220421101210954"></p><p>运行到此处，然后查看 R15 的值</p><p><img data-src="image-20220421101357347.png" alt="image-20220421101357347"></p><p>指向 0x400A50, 继续执行</p><p><img data-src="image-20220421102305963.png" alt="image-20220421102305963"></p><p>到这里之后 F8 步过</p><p><img data-src="image-20220421102344660.png" alt="image-20220421102344660"></p><p>接着我们发现我们到了 OEP 的地址，也是之前堆栈中的地址。找到 OEP 后，用脚本将脱壳后的文件 dump 出来</p><pre><code class="language-idc">#include &lt;idc.idc&gt;
#define PT_LOAD              1
#define PT_DYNAMIC           2
static main(void)
&#123;
         auto ImageBase,StartImg,EndImg;
         auto e_phoff;
         auto e_phnum,p_offset;
         auto i,dumpfile;
         ImageBase=0x400000;
         StartImg=0x400000;
         EndImg=0x0;
         if (Dword(ImageBase)==0x7f454c46 || Dword(ImageBase)==0x464c457f )
  &#123;
    if(dumpfile=fopen(&quot;G:\\dumpfile&quot;,&quot;wb&quot;)) //这里的地址是dump出的文件保存地址
    &#123;
      e_phoff=ImageBase+Qword(ImageBase+0x20);
      Message(&quot;e_phoff = 0x%x\n&quot;, e_phoff);
      e_phnum=Word(ImageBase+0x38);
      Message(&quot;e_phnum = 0x%x\n&quot;, e_phnum);
      for(i=0;i&lt;e_phnum;i++)
      &#123;
         if (Dword(e_phoff)==PT_LOAD || Dword(e_phoff)==PT_DYNAMIC)
                         &#123; 
                                 p_offset=Qword(e_phoff+0x8);
                                 StartImg=Qword(e_phoff+0x10);
                                 EndImg=StartImg+Qword(e_phoff+0x28);
                                 Message(&quot;start = 0x%x, end = 0x%x, offset = 0x%x\n&quot;, StartImg, EndImg, p_offset);
                                 dump(dumpfile,StartImg,EndImg,p_offset);
                                 Message(&quot;dump segment %d ok.\n&quot;,i);
                         &#125;    
         e_phoff=e_phoff+0x38;
      &#125;

      fseek(dumpfile,0x3c,0);
      fputc(0x00,dumpfile);
      fputc(0x00,dumpfile);
      fputc(0x00,dumpfile);
      fputc(0x00,dumpfile);

      fseek(dumpfile,0x28,0);
      fputc(0x00,dumpfile);
      fputc(0x00,dumpfile);
      fputc(0x00,dumpfile);
      fputc(0x00,dumpfile);
      fputc(0x00,dumpfile);
      fputc(0x00,dumpfile);
      fputc(0x00,dumpfile);
      fputc(0x00,dumpfile);

      fclose(dumpfile);
        &#125;else Message(&quot;dump err.&quot;);
 &#125;
&#125;
static dump(dumpfile,startimg,endimg,offset) 
&#123;
        auto i;
        auto size;
        size=endimg-startimg;
        fseek(dumpfile,offset,0);
        for ( i=0; i &lt; size; i=i+1 ) 
        &#123;
        fputc(Byte(startimg+i),dumpfile);
        &#125;
&#125;
</code></pre><p>在 OEP 处打开脚本 dump. 生成脱壳后的原文件</p><h5 id="解题"><a class="anchor" href="#解题">#</a> 解题</h5><p><img data-src="image-20220421103801876.png" alt="image-20220421103801876"></p><p>运行之后进入 IDA，查找字符串，到达主函数</p><p><img data-src="image-20220421104756503.png" alt="image-20220421104756503"></p><p>进入加密函数 ，、</p><p><img data-src="image-20220421104943844.png" alt="image-20220421104943844"></p><p><img data-src="image-20220421104954374.png" alt="image-20220421104954374"></p><p>可以判断后面的 V14 数组大概率是密文，后面是判断，而前面的循环就是加密过程了，进入关键加密函数，发现是明显的 TEA 加密算法，所以直接可以写逆向脚本</p><figure class="highlight c"><figcaption data-lang="c"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdio.h></span></span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="4"></td><td><pre>    <span class="token keyword">int</span> delta <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="5"></td><td><pre>    <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> i<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>i<span class="token operator">&lt;=</span><span class="token number">31</span><span class="token punctuation">;</span><span class="token operator">++</span>i<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="6"></td><td><pre>    <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="7"></td><td><pre>        delta <span class="token operator">+=</span><span class="token number">0x6F361F7C</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="8"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="9"></td><td><pre>    <span class="token keyword">long</span> <span class="token keyword">long</span> <span class="token keyword">int</span> v14<span class="token punctuation">[</span><span class="token number">27</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token punctuation">&#123;</span><span class="token number">0</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="10"></td><td><pre>    v14<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">0x507BC5BC</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="11"></td><td><pre>  v14<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">0x2B989A22</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="12"></td><td><pre>  v14<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">0x63A48F40</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="13"></td><td><pre>  v14<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">2831241988</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="14"></td><td><pre>  v14<span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">0x7451189A</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="15"></td><td><pre>  v14<span class="token punctuation">[</span><span class="token number">5</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">0x8A3E7CCF</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="16"></td><td><pre>  v14<span class="token punctuation">[</span><span class="token number">6</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">0x62CA9921</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="17"></td><td><pre>  v14<span class="token punctuation">[</span><span class="token number">7</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">0xE1B5C82</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="18"></td><td><pre>  v14<span class="token punctuation">[</span><span class="token number">8</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">0xC3965CA9</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="19"></td><td><pre>  v14<span class="token punctuation">[</span><span class="token number">9</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">0xD6268AA1</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="20"></td><td><pre>  v14<span class="token punctuation">[</span><span class="token number">10</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">0x22AC5103</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="21"></td><td><pre>  v14<span class="token punctuation">[</span><span class="token number">11</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">0x9ACC9D7E</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="22"></td><td><pre>  v14<span class="token punctuation">[</span><span class="token number">12</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">0x224A7DC3</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="23"></td><td><pre>  v14<span class="token punctuation">[</span><span class="token number">13</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">0xD588C510</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="24"></td><td><pre>  v14<span class="token punctuation">[</span><span class="token number">14</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">0xCB432BE4</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="25"></td><td><pre>  v14<span class="token punctuation">[</span><span class="token number">15</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">0xB6A13511</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="26"></td><td><pre>  v14<span class="token punctuation">[</span><span class="token number">16</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">0x4C3513DC</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="27"></td><td><pre>  v14<span class="token punctuation">[</span><span class="token number">17</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">0x6FCEEBC1</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="28"></td><td><pre>  v14<span class="token punctuation">[</span><span class="token number">18</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">0xA3614D20</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="29"></td><td><pre>  v14<span class="token punctuation">[</span><span class="token number">19</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">0x87C441CC</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="30"></td><td><pre>  v14<span class="token punctuation">[</span><span class="token number">20</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">0xA1F95799</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="31"></td><td><pre>  v14<span class="token punctuation">[</span><span class="token number">21</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">0x3E6DD14A</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="32"></td><td><pre>  v14<span class="token punctuation">[</span><span class="token number">22</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">0x6F28852F</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="33"></td><td><pre>  v14<span class="token punctuation">[</span><span class="token number">23</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">0x52AC745F</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="34"></td><td><pre>  v14<span class="token punctuation">[</span><span class="token number">24</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">0x9190AC59</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="35"></td><td><pre>  v14<span class="token punctuation">[</span><span class="token number">25</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">0x16DE2CFB</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="36"></td><td><pre>    <span class="token keyword">unsigned</span> <span class="token keyword">int</span> v3<span class="token punctuation">,</span>v4<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="37"></td><td><pre>    <span class="token keyword">int</span> a<span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token punctuation">&#123;</span><span class="token number">111</span><span class="token punctuation">,</span><span class="token number">54</span><span class="token punctuation">,</span><span class="token number">31</span><span class="token punctuation">,</span><span class="token number">124</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="38"></td><td><pre>    <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> i<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>i<span class="token operator">&lt;</span><span class="token number">26</span><span class="token punctuation">;</span>i<span class="token operator">+=</span><span class="token number">2</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="39"></td><td><pre>    <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="40"></td><td><pre>        <span class="token keyword">int</span> num<span class="token operator">=</span> delta<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="41"></td><td><pre>        v3 <span class="token operator">=</span> v14<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="42"></td><td><pre>        v4 <span class="token operator">=</span> v14<span class="token punctuation">[</span>i<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="43"></td><td><pre>        <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> k<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>k<span class="token operator">&lt;=</span><span class="token number">31</span><span class="token punctuation">;</span>k<span class="token operator">++</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="44"></td><td><pre>        <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="45"></td><td><pre>            v4 <span class="token operator">-=</span><span class="token punctuation">(</span>v3<span class="token operator">+</span>num<span class="token punctuation">)</span><span class="token operator">^</span><span class="token punctuation">(</span><span class="token punctuation">(</span>v3<span class="token operator">&lt;&lt;</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token operator">+</span>a<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">^</span><span class="token punctuation">(</span><span class="token punctuation">(</span>v3<span class="token operator">>></span><span class="token number">5</span><span class="token punctuation">)</span><span class="token operator">+</span>a<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="46"></td><td><pre>            v3 <span class="token operator">-=</span><span class="token punctuation">(</span>v4<span class="token operator">+</span>num<span class="token punctuation">)</span><span class="token operator">^</span><span class="token punctuation">(</span><span class="token punctuation">(</span>v4<span class="token operator">&lt;&lt;</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token operator">+</span>a<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">^</span><span class="token punctuation">(</span><span class="token punctuation">(</span>v4<span class="token operator">>></span><span class="token number">5</span><span class="token punctuation">)</span><span class="token operator">+</span>a<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="47"></td><td><pre>            num <span class="token operator">-=</span><span class="token number">0x6F361F7C</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="48"></td><td><pre>        <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="49"></td><td><pre>        v14<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token operator">=</span>v3<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="50"></td><td><pre>        v14<span class="token punctuation">[</span>i<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token operator">=</span>v4<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="51"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="52"></td><td><pre>    <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> i<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>i<span class="token operator">&lt;=</span><span class="token number">25</span><span class="token punctuation">;</span>i<span class="token operator">++</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="53"></td><td><pre>    <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="54"></td><td><pre>        <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"%c"</span><span class="token punctuation">,</span>v14<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="55"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="56"></td><td><pre>    <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="57"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="58"></td><td><pre><span class="token comment">/*</span></pre></td></tr><tr><td data-num="59"></td><td><pre>output：ctfshow&#123;just_a_simple_re&#125;</pre></td></tr><tr><td data-num="60"></td><td><pre>*/</pre></td></tr></table></figure><p>所以最后的 flag 是</p><blockquote><p><strong>ctfshow{just_a_simple_re}</strong></p></blockquote><h4 id="babyoc"><a class="anchor" href="#babyoc">#</a> babyOC</h4><p>烷基八氮</p><p>ubuntu 支持的 libgnustep-base 最高版本是 1.26，但是这个文件需要的版本是 1.28</p><p>而且重要的<strong> Objective-C 使用动态运行时类型</strong>，在此基础上增加了<span class="exturl" data-url="aHR0cHM6Ly9iYWlrZS5iYWlkdS5jb20vaXRlbS8lRTklOUQlQTIlRTUlOTAlOTElRTUlQUYlQjklRTglQjElQTElRTclQkMlOTYlRTclQTglOEIlRTglQUYlQUQlRTglQTglODA=">面向对象编程语言</span>的特性以及<span class="exturl" data-url="aHR0cHM6Ly9iYWlrZS5iYWlkdS5jb20vaXRlbS9TbWFsbHRhbGs="> Smalltalk</span> 消息机制</p><p>这种消息特性决定逆向 objective-c 必须通过动态调试来得知函数的作用</p><p>贴一个参考的大佬博客，也是该题一血</p><p>[babyOC_wp](<span class="exturl" data-url="aHR0cHM6Ly9ibG9nLnRyYWNrb255b3UudG9wLzIwMjEvMDYvMjYvYTFhYWI3OGRjNDE0Lw==">「CTFSHOW」Rev 随缘更新 (trackonyou.top)</span>)</p><p>使用 IDA</p><p><img data-src="image-20220421231237984.png" alt></p><p>发现 objc_msg_lookup 函数 频繁出现</p><p><img data-src="image-20220421234753880.png" alt="image-20220421234753880"></p><p>大意就是接收参数，返回一个函数指针，个人猜测可能就是 objective-c 特有的 Smalltalk 消息机制，通过查看函数的第二个参数就能大概知道函数的作用，但是具体实现得通过动态调试分析</p><p><img data-src="image-20220421235323032.png" alt="image-20220421235323032"></p><p>查看 init xref 进入函数</p><p><img data-src="image-20220421235408609.png" alt="image-20220421235408609"></p><p>这里就是初始化的函数（加密）</p><p>有两个大循环 ，应该是分别对奇数位和偶数位运算，具体运算还是得靠动态调试</p><p>而且密文也得靠动态调试得到</p><p>套用大佬的 keygen</p><figure class="highlight python"><figcaption data-lang="python"></figcaption><table><tr><td data-num="1"></td><td><pre>data <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">1270</span><span class="token punctuation">,</span> <span class="token number">2767</span><span class="token punctuation">,</span> <span class="token number">5549</span><span class="token punctuation">,</span> <span class="token number">9672</span><span class="token punctuation">,</span> <span class="token number">11938</span><span class="token punctuation">,</span> <span class="token number">16093</span><span class="token punctuation">,</span> <span class="token number">29864</span><span class="token punctuation">,</span> <span class="token number">30379</span><span class="token punctuation">,</span> <span class="token number">22184</span><span class="token punctuation">,</span> <span class="token number">20690</span><span class="token punctuation">,</span> <span class="token number">25002</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="2"></td><td><pre>        <span class="token number">65039</span><span class="token punctuation">,</span> <span class="token number">65793</span><span class="token punctuation">,</span> <span class="token number">97983</span><span class="token punctuation">,</span> <span class="token number">100411</span><span class="token punctuation">,</span> <span class="token number">67904</span><span class="token punctuation">,</span> <span class="token number">88053</span><span class="token punctuation">,</span> <span class="token number">28147</span><span class="token punctuation">,</span> <span class="token number">18776</span><span class="token punctuation">,</span> <span class="token number">71764</span><span class="token punctuation">,</span> <span class="token number">127654</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="3"></td><td><pre>        <span class="token number">39994</span><span class="token punctuation">,</span> <span class="token number">30276</span><span class="token punctuation">,</span> <span class="token number">33151</span><span class="token punctuation">,</span> <span class="token number">49377</span><span class="token punctuation">,</span> <span class="token number">62682</span><span class="token punctuation">,</span> <span class="token number">128398</span><span class="token punctuation">,</span> <span class="token number">32406</span><span class="token punctuation">]</span></pre></td></tr><tr><td data-num="4"></td><td><pre></pre></td></tr><tr><td data-num="5"></td><td><pre>key <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">0x4E1</span> <span class="token operator">*</span> i <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">28</span><span class="token punctuation">)</span><span class="token punctuation">]</span></pre></td></tr><tr><td data-num="6"></td><td><pre></pre></td></tr><tr><td data-num="7"></td><td><pre><span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">28</span><span class="token punctuation">)</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="8"></td><td><pre>    <span class="token keyword">if</span> i <span class="token operator">%</span> <span class="token number">2</span> <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="9"></td><td><pre>        data<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">^</span><span class="token operator">=</span> data<span class="token punctuation">[</span>i <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">]</span></pre></td></tr><tr><td data-num="10"></td><td><pre>    <span class="token keyword">else</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="11"></td><td><pre>        data<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">-=</span> data<span class="token punctuation">[</span>i <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">]</span></pre></td></tr><tr><td data-num="12"></td><td><pre></pre></td></tr><tr><td data-num="13"></td><td><pre><span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">26</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="14"></td><td><pre>    <span class="token keyword">if</span> i <span class="token operator">%</span> <span class="token number">2</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="15"></td><td><pre>        data<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">^</span><span class="token operator">=</span> data<span class="token punctuation">[</span>i <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">]</span></pre></td></tr><tr><td data-num="16"></td><td><pre>    <span class="token keyword">else</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="17"></td><td><pre>        data<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">-=</span> data<span class="token punctuation">[</span>i <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">]</span></pre></td></tr><tr><td data-num="18"></td><td><pre></pre></td></tr><tr><td data-num="19"></td><td><pre><span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">28</span><span class="token punctuation">)</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="20"></td><td><pre>    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token builtin">chr</span><span class="token punctuation">(</span>data<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">^</span> key<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span> end<span class="token operator">=</span><span class="token string">''</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="21"></td><td><pre><span class="token triple-quoted-string string">'''</span></pre></td></tr><tr><td data-num="22"></td><td><pre>output: ctfshow&#123;babyＯｂｊＣ,你真的解出来了TQL&#125;</pre></td></tr><tr><td data-num="23"></td><td><pre>'''</pre></td></tr></table></figure><blockquote><p><strong>ctfshow {babyＯｂｊＣ, 你真的解出来了 TQL}</strong></p></blockquote><div class="tags"><a href="/tags/Reverse-wp-ctfshow-%E5%8D%B7%E7%8E%8B%E6%9D%AF/" rel="tag"><i class="ic i-tag"></i> Reverse_wp_ctfshow_卷王杯</a></div></div><footer><div class="meta"><span class="item"><span class="icon"><i class="ic i-calendar-check"></i> </span><span class="text">Edited on</span> <time title="Modified: 2022-04-22 00:02:38" itemprop="dateModified" datetime="2022-04-22T00:02:38+08:00">2022-04-22</time> </span><span id="2022/04/21/CTFshow卷王杯wp/" class="item leancloud_visitors" data-flag-title="CTFshow卷王杯wp" title="Views"><span class="icon"><i class="ic i-eye"></i> </span><span class="text">Views</span> <span class="leancloud-visitors-count"></span> <span class="text">times</span></span></div><div class="reward"><button><i class="ic i-heartbeat"></i> Donate</button><p>Give me a cup of [coffee]~(￣▽￣)~*</p><div id="qr"><div><img data-src="/images/wechatpay.png" alt="那我就让时光倒流 WeChat Pay"><p>WeChat Pay</p></div><div><img data-src="/images/alipay.png" alt="那我就让时光倒流 Alipay"><p>Alipay</p></div></div></div><div id="copyright"><ul><li class="author"><strong>Post author: </strong>那我就让时光倒流 <i class="ic i-at"><em>@</em></i>你越安静,你能听到的就越多</li><li class="link"><strong>Post link: </strong><a href="https://0x401000nu1l.github.io/2022/04/21/CTFshow%E5%8D%B7%E7%8E%8B%E6%9D%AFwp/" title="CTFshow卷王杯wp">https://0x401000nu1l.github.io/2022/04/21/CTFshow卷王杯wp/</a></li><li class="license"><strong>Copyright Notice: </strong>All articles in this blog are licensed under <span class="exturl" data-url="aHR0cHM6Ly9jcmVhdGl2ZWNvbW1vbnMub3JnL2xpY2Vuc2VzL2J5LW5jLXNhLzQuMC9kZWVkLnpo"><i class="ic i-creative-commons"><em>(CC)</em></i>BY-NC-SA</span> unless stating additionally.</li></ul></div></footer></article></div><div class="post-nav"><div class="item left"><a href="/2022/04/20/starCTF%E9%80%86%E5%90%91wp/" itemprop="url" rel="prev" data-background-image="https:&#x2F;&#x2F;tva2.sinaimg.cn&#x2F;mw690&#x2F;6833939bly1giclx6phq6j20zk0m8e36.jpg" title="starCTF逆向wp"><span class="type">Previous Post</span> <span class="category"><i class="ic i-flag"></i></span><h3>starCTF逆向wp</h3></a></div><div class="item right"><a href="/2022/04/29/%E5%B7%A6%E8%BD%AC/" itemprop="url" rel="next" data-background-image="https:&#x2F;&#x2F;tva2.sinaimg.cn&#x2F;mw690&#x2F;6833939bly1giclga70tsj20zk0m84mr.jpg" title="左转"><span class="type">Next Post</span> <span class="category"><i class="ic i-flag"></i></span><h3>左转</h3></a></div></div><div class="wrap" id="comments"></div></div><div id="sidebar"><div class="inner"><div class="panels"><div class="inner"><div class="contents panel pjax" data-title="Contents"><ol class="toc"><li class="toc-item toc-level-3"><a class="toc-link" href="#ctfshow-%E5%8D%B7%E7%8E%8B%E6%9D%AF-wp"><span class="toc-number">1.</span> <span class="toc-text">CTFshow 卷王杯 wp</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%AE%80%E5%8D%95%E7%9A%84re"><span class="toc-number">1.1.</span> <span class="toc-text">简单的 re</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E8%AE%B0%E5%BD%95%E4%B8%80%E6%AC%A1%E8%84%B1%E5%A3%B3"><span class="toc-number">1.1.1.</span> <span class="toc-text">记录一次脱壳</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E8%A7%A3%E9%A2%98"><span class="toc-number">1.1.2.</span> <span class="toc-text">解题</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#babyoc"><span class="toc-number">1.2.</span> <span class="toc-text">babyOC</span></a></li></ol></li></ol></div><div class="related panel pjax" data-title="Related"></div><div class="overview panel" data-title="Overview"><div class="author" itemprop="author" itemscope itemtype="http://schema.org/Person"><img class="image" itemprop="image" alt="那我就让时光倒流" data-src="/images/avatar.jpg"><p class="name" itemprop="name">那我就让时光倒流</p><div class="description" itemprop="description">(σﾟ∀ﾟ)σ..:*☆哎哟不错哦</div></div><nav class="state"><div class="item posts"><a href="/archives/"><span class="count">9</span> <span class="name">posts</span></a></div><div class="item tags"><a href="/tags/"><span class="count">7</span> <span class="name">tags</span></a></div></nav><div class="social"><span class="exturl item github" data-url="aHR0cHM6Ly9naXRodWIuY29tLzB4NDAxMDAwTnUxbA==" title="https:&#x2F;&#x2F;github.com&#x2F;0x401000Nu1l"><i class="ic i-github"></i></span> <span class="exturl item email" data-url="bWFpbHRvOnhpbmR1MTEwNkBnYW1pbC5jb20=" title="mailto:xindu1106@gamil.com"><i class="ic i-envelope"></i></span></div><ul class="menu"><li class="item"><a href="/" rel="section"><i class="ic i-home"></i>Home</a></li><li class="item"><a href="/friends/" rel="section"><i class="ic i-heart"></i>friends</a></li></ul></div></div></div><ul id="quick"><li class="prev pjax"><a href="/2022/04/20/starCTF%E9%80%86%E5%90%91wp/" rel="prev" title="Previous Post"><i class="ic i-chevron-left"></i></a></li><li class="up"><i class="ic i-arrow-up"></i></li><li class="down"><i class="ic i-arrow-down"></i></li><li class="next pjax"><a href="/2022/04/29/%E5%B7%A6%E8%BD%AC/" rel="next" title="Next Post"><i class="ic i-chevron-right"></i></a></li><li class="percent"></li></ul></div></div><div class="dimmer"></div></div></main><footer id="footer"><div class="inner"><div class="widgets"><div class="rpost pjax"><h2>Random Posts</h2><ul><li class="item"><div class="breadcrumb"></div><span><a href="/2022/04/13/plan/" title="plan">plan</a></span></li><li class="item"><div class="breadcrumb"></div><span><a href="/2022/04/12/%E4%BA%8C%E8%BF%9B%E5%88%B6%E7%82%B8%E5%BC%B9/" title="二进制炸弹">二进制炸弹</a></span></li><li class="item"><div class="breadcrumb"></div><span><a href="/2022/04/20/starCTF%E9%80%86%E5%90%91wp/" title="starCTF逆向wp">starCTF逆向wp</a></span></li><li class="item"><div class="breadcrumb"></div><span><a href="/2022/04/21/CTFshow%E5%8D%B7%E7%8E%8B%E6%9D%AFwp/" title="CTFshow卷王杯wp">CTFshow卷王杯wp</a></span></li><li class="item"><div class="breadcrumb"></div><span><a href="/2022/04/19/%E5%8F%B2%E4%B8%8A%E6%9C%80%E5%B0%8F%E7%9A%84elf%E6%96%87%E4%BB%B6/" title="史上最小的elf文件">史上最小的elf文件</a></span></li><li class="item"><div class="breadcrumb"></div><span><a href="/2022/04/18/%E6%B1%87%E7%BC%96-%E7%B3%BB%E7%BB%9F%E8%B0%83%E7%94%A8/" title="汇编语言中系统调用">汇编语言中系统调用</a></span></li><li class="item"><div class="breadcrumb"></div><span><a href="/2022/04/29/%E5%B7%A6%E8%BD%AC/" title="左转">左转</a></span></li><li class="item"><div class="breadcrumb"></div><span><a href="/2022/04/16/CTFshow36D%E6%9D%AFwp/" title="CTFshow36D杯wp">CTFshow36D杯wp</a></span></li><li class="item"><div class="breadcrumb"></div><span><a href="/2022/05/03/DASCTF%E9%80%86%E5%90%91%E9%83%A8%E5%88%86wp/" title="DASCTF逆向部分wp">DASCTF逆向部分wp</a></span></li></ul></div><div><h2>Recent Comments</h2><ul class="leancloud-recent-comment"></ul></div></div><div class="status"><div class="copyright">&copy; 2010 – <span itemprop="copyrightYear">2022</span> <span class="with-love"><i class="ic i-sakura rotate"></i> </span><span class="author" itemprop="copyrightHolder">那我就让时光倒流 @ 那我就让时光倒流</span></div><div class="count"><span class="post-meta-item-icon"><i class="ic i-chart-area"></i> </span><span title="Symbols count total">35k words</span> <span class="post-meta-divider">|</span> <span class="post-meta-item-icon"><i class="ic i-coffee"></i> </span><span title="Reading time total">32 mins.</span></div><div class="powered-by">Powered by <span class="exturl" data-url="aHR0cHM6Ly9oZXhvLmlv">Hexo</span> & Theme.<span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL2FtZWhpbWUvaGV4by10aGVtZS1zaG9rYQ==">Shoka</span></div></div></div></footer></div><script data-config type="text/javascript">var LOCAL={path:"2022/04/21/CTFshow卷王杯wp/",favicon:{show:"（●´3｀●）Goooood",hide:"(´Д｀)Booooom"},search:{placeholder:"Search for Posts",empty:"We didn't find any results for the search: ${query}",stats:"${hits} results found in ${time} ms"},valine:!0,fancybox:!0,copyright:'Copied to clipboard successfully! <br> All articles in this blog are licensed under <i class="ic i-creative-commons"></i>BY-NC-SA.',ignores:[function(e){return e.includes("#")},function(e){return new RegExp(LOCAL.path+"$").test(e)}]}</script><script src="https://cdn.polyfill.io/v2/polyfill.js"></script><script src="//cdn.jsdelivr.net/combine/npm/pace-js@1.0.2/pace.min.js,npm/pjax@0.2.8/pjax.min.js,npm/whatwg-fetch@3.4.0/dist/fetch.umd.min.js,npm/animejs@3.2.0/lib/anime.min.js,npm/algoliasearch@4/dist/algoliasearch-lite.umd.js,npm/instantsearch.js@4/dist/instantsearch.production.min.js,npm/lozad@1/dist/lozad.min.js,npm/quicklink@2/dist/quicklink.umd.js"></script><script src="/js/app.js?v=0.2.5"></script></body></html>